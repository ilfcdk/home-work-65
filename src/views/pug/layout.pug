doctype html
html(lang="uk" data-theme=theme)
  head
    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width, initial-scale=1")
    title #{typeof title !== 'undefined' ? title : 'App'}
    link(rel="icon" href="/favicon.ico")
    link(rel="stylesheet" href="/public/css/styles.css")
    // — ІНЛАЙН-СКРИПТ: надійне встановлення теми за cookie (light/dark/auto)
    script.
      (function() {
        function getCookie(name) {
          const m = document.cookie.match(new RegExp('(?:^|; )' + name.replace(/([$?*|{}\(\)\[\]\\\/\+^])/g, '\\$1') + '=([^;]*)'));
          return m ? decodeURIComponent(m[1]) : null;
        }
        var theme = getCookie('theme') || '#{theme || 'light'}';
        if (theme === 'auto') {
          var prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
          if (window.matchMedia) {
            var mq = window.matchMedia('(prefers-color-scheme: dark)');
            if (mq.addEventListener) {
              mq.addEventListener('change', function(e){ document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light'); });
            } else if (mq.addListener) {
              mq.addListener(function(e){ document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light'); });
            }
          }
        } else {
          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
  body
    header.nav
      a.brand(href='/') Express App
      nav
        a(href='/users') Users
        a(href='/articles') Articles
        // Перемикач теми
        form(method='post', action='/preferences/theme', style='display:inline')
          select(name='theme')
            option(value='light' selected=theme==='light') light
            option(value='dark' selected=theme==='dark') dark
            option(value='auto' selected=theme==='auto') auto
          button.btn.inline(type='submit') Set theme
        if currentUser
          form(method='post', action='/auth/logout', style='display:inline')
            button.btn.inline(type='submit') Logout (#{currentUser.role})
        else
          a(href='/auth/login') Login
          a(href='/auth/register') Register

    // FLASH-блок для msg (щоб не було [object Object])
    if typeof msg !== 'undefined' && msg
      - const flashText = (typeof msg === 'object' && msg !== null && msg.text) ? msg.text : msg
      if flashText
        .flash.flash--error= flashText

    main.container
      block content
    footer.footer © #{new Date().getFullYear()} — Demo
